import React,{useEffect,useState} from 'react'; import api from '../../api';
export default function AdminPromos(){ const [rows,setRows]=useState([]); const [form,setForm]=useState({code:'', type:'percent', value:10});
  const load=()=>api.get('/api/admin/promos').then(r=>setRows(r.data)); useEffect(()=>{ load(); },[]);
  const add=async()=>{ await api.post('/api/admin/promos', {...form, code: form.code.toUpperCase()}); setForm({code:'', type:'percent', value:10}); load(); };
  const save=async(p)=>{ await api.patch(`/api/admin/promos/${p.id}`, p); load(); };
  const del=async(id)=>{ if(confirm('Supprimer ?')){ await api.delete(`/api/admin/promos/${id}`); load(); } };
  return (<div className="bg-white rounded-2xl p-6 shadow"><h2 className="text-2xl font-bold mb-4">Codes promo</h2><div className="flex flex-wrap gap-2 mb-4"><input placeholder="CODE" className="border rounded px-3 py-2" value={form.code} onChange={e=>setForm({...form,code:e.target.value})}/><select className="border rounded px-3 py-2" value={form.type} onChange={e=>setForm({...form,type:e.target.value})}><option value="percent">% (pourcentage)</option><option value="amount">â‚¬ (cents)</option></select><input placeholder="Valeur" className="border rounded px-3 py-2 w-28" value={form.value} onChange={e=>setForm({...form,value:Number(e.target.value)||0})}/><button onClick={add} className="px-4 rounded bg-indigo-600 text-white">Ajouter</button></div><table className="w-full text-sm"><thead><tr className="text-left border-b"><th>Code</th><th>Type</th><th>Valeur</th><th>Redeems</th><th></th></tr></thead><tbody>{rows.map(p=>(<tr key={p.id} className="border-b last:border-0"><td><input defaultValue={p.code} onChange={e=>p.code=e.target.value} className="border rounded px-2 w-28"/></td><td><select defaultValue={p.type} onChange={e=>p.type=e.target.value} className="border rounded px-2 py-1"><option value="percent">percent</option><option value="amount">amount</option></select></td><td><input defaultValue={p.value} onChange={e=>p.value=Number(e.target.value)} className="border rounded px-2 w-20"/></td><td className="text-gray-600">{p.redemptions}</td><td className="text-right"><button onClick={()=>save(p)} className="px-3 py-1 rounded border">Enregistrer</button><button onClick={()=>del(p.id)} className="ml-2 px-3 py-1 rounded border text-red-600">Supprimer</button></td></tr>))}</tbody></table></div>) }