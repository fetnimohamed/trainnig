import React,{useEffect,useState} from 'react'; import api from '../../api';
export default function AdminPacks(){ const [packs,setPacks]=useState([]); const [courses,setCourses]=useState([]); const [form,setForm]=useState({name:'', description:'', price_cents:0, is_published:true, course_ids:[]});
  const load=()=>api.get('/api/admin/packs').then(r=>setPacks(r.data)); const loadCourses=()=>api.get('/api/admin/courses').then(r=>setCourses(r.data)); useEffect(()=>{ load(); loadCourses(); },[]);
  const add=async()=>{ await api.post('/api/admin/packs', {...form, price_cents:Number(form.price_cents)||0}); setForm({name:'', description:'', price_cents:0, is_published:true, course_ids:[]}); load(); };
  const save=async(p)=>{ await api.patch(`/api/admin/packs/${p.id}`, {...p, price_cents:Number(p.price_cents)||0, course_ids:p.course_ids||[]}); load(); };
  const del=async(id)=>{ if(confirm('Supprimer pack ?')){ await api.delete(`/api/admin/packs/${id}`); load(); } };
  return (<div className="bg-white rounded-2xl p-6 shadow"><h2 className="text-2xl font-bold mb-4">Packs</h2>
    <div className="grid md:grid-cols-2 gap-3 mb-6"><input placeholder="Nom" className="border rounded px-3 py-2" value={form.name} onChange={e=>setForm({...form,name:e.target.value})}/><input placeholder="Prix (cents)" className="border rounded px-3 py-2" value={form.price_cents} onChange={e=>setForm({...form,price_cents:e.target.value})}/><textarea placeholder="Description" className="border rounded px-3 py-2 md:col-span-2" value={form.description} onChange={e=>setForm({...form,description:e.target.value})}/><label className="flex items-center gap-2"><input type="checkbox" checked={form.is_published} onChange={e=>setForm({...form,is_published:e.target.checked})}/> Publié</label><div className="md:col-span-2"><div className="text-sm text-gray-600 mb-2">Cours inclus</div><div className="grid grid-cols-2 md:grid-cols-4 gap-2 max-h-40 overflow-auto border rounded p-2">{courses.map(c=>(<label key={c.id} className="flex items-center gap-2 text-sm"><input type="checkbox" checked={form.course_ids.includes(c.id)} onChange={e=>{ const next=new Set(form.course_ids); e.target.checked? next.add(c.id): next.delete(c.id); setForm({...form, course_ids:[...next]}); }}/>{c.title}</label>))}</div></div><button onClick={add} className="px-4 py-2 rounded bg-indigo-600 text-white">Ajouter pack</button></div>
    <table className="w-full text-sm"><thead><tr className="text-left border-b"><th>Nom</th><th>Prix</th><th>Publié</th><th></th></tr></thead><tbody>{packs.map(p=>(<tr key={p.id} className="border-b last:border-0 align-top"><td><input defaultValue={p.name} onChange={e=>p.name=e.target.value} className="border rounded px-2"/></td><td><input defaultValue={p.price_cents} onChange={e=>p.price_cents=Number(e.target.value)} className="border rounded px-2 w-24"/></td><td><input type="checkbox" defaultChecked={!!p.is_published} onChange={e=>p.is_published=e.target.checked?1:0}/></td><td className="text-right"><button onClick={()=>save(p)} className="px-3 py-1 rounded border">Enregistrer</button><button onClick={()=>del(p.id)} className="ml-2 px-3 py-1 rounded border text-red-600">Supprimer</button></td></tr>))}</tbody></table></div>) }